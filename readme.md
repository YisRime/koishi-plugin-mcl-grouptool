# koishi-plugin-mcl-grouptool

[![npm](https://img.shields.io/npm/v/koishi-plugin-mcl-grouptool?style=flat-square)](https://www.npmjs.com/package/koishi-plugin-mcl-grouptool)

MC 启动器群助手 - 专为 Minecraft 启动器群设计（自用）

## 功能特性

- 🔧 **自动错误文件检测**：识别 HMCL、PCL2、BakaXL 启动器的错误报告文件
- 🔀 **智能引导分流**：自动引导用户到对应启动器的技术支持群
- 🎯 **关键词自动回复**：支持正则表达式匹配的关键词回复系统
- 🚫 **防重复发送**：智能防止重复消息发送，避免刷屏
- 👥 **用户权限管理**：支持白名单用户管理
- 📝 **手动发送命令**：管理员可手动触发预设回复
- 📸 **图片转发与OCR**：自动转发图片到指定群组/用户，并进行OCR文字识别

## 支持的启动器

| 启动器 | 技术支持群 | 支持群组 | 错误文件格式 |
|--------|------------|----------|--------------|
| HMCL | 666546887 | 633640264, 203232161, 201034984, 533529045, 744304553, 282845310, 482624681, 991620626, 657677715, 775084843 | minecraft-exported-crash-info-YYYY-MM-DDTHH-MM-SS.zip |
| PCL2 | 978054335 | 1028074835 | 错误报告-YYYY-M-D_HH.MM.SS.zip |
| BakaXL | 377521448 | 480455628, 377521448 | BakaXL-ErrorCan-XXXXXXXXXXXXXX.json |

### 命令列表

| 命令 | 参数 | 描述 | 权限要求 |
|------|------|------|----------|
| `send` | `<关键词> [目标用户]` | 发送预设的关键词回复 | 白名单用户 |

#### 命令详细说明

- `<关键词>`：必需参数，在关键词配置中定义的关键词
- `[目标用户]`：可选参数，可以是以下格式：
  - `@用户` - 直接@某个用户
  - `@123456789` - @加用户ID
  - `123456789` - 纯用户ID
- 如果指定了目标用户，消息会@该用户；否则根据配置决定是否@发送者

### 工作原理

1. **群组识别**：插件会自动识别当前群组属于哪个启动器的支持群
2. **文件检测**：当用户上传文件时，插件会检查文件名是否匹配对应启动器的错误报告格式
3. **智能引导**：
   - 如果在正确的群上传对应启动器的错误文件：提示本群可以解决问题，并提供技术支持群
   - 如果在错误的群上传其他启动器的错误文件：提示本群不解决其他启动器问题，引导到对应技术支持群

## 配置选项

### 回复配置

- `preventDup`: 延迟发送提示（默认开启）
- `quote`: 回复时引用消息（默认开启）
- `mention`: 回复时@用户（默认关闭）

### 用户权限配置

- `whitelist`: 允许使用命令的用户白名单

### 关键词配置

- `keyword`: 关键词
- `reply`: 回复内容
- `regex`: 正则表达式匹配

### 转发配置

- `forwardType`: 转发类型，可选值：`group`（群聊）或 `user`（私聊）
- `forwardTarget`: 转发目标ID（群号或用户QQ号）

## 图片转发与OCR功能

当配置了转发设置后，插件会自动：

1. **图片转发**：将群内发送的图片转发到指定的群聊或私聊
2. **OCR识别**：对转发的图片进行文字识别，并将识别结果一同转发
3. **来源标记**：转发消息会包含发送者昵称、来源群组等信息

### 转发消息格式

- 图片消息：`发送者昵称（群号）发送图片：[图片]`
- OCR结果：`OCR识别结果：\n[识别到的文字内容]`

## 使用方法

### 命令使用

```text
send <关键词> [目标用户]
```

- 发送预设的关键词回复
- 可指定目标用户（支持 @用户 或 用户ID）
- 仅白名单用户可使用

### 自动功能

1. **错误文件检测**：当用户上传对应启动器的错误文件时，自动发送技术支持群信息
2. **关键词回复**：当消息匹配配置的关键词或正则表达式时，自动发送对应回复
3. **智能防重**：3秒内检测到技术支持群号时取消重复发送
4. **图片转发**：自动转发图片到指定目标，并进行OCR文字识别

## 注意事项

1. **权限要求**：使用 `send` 命令需要在白名单中
2. **OCR功能**：需要机器人支持 OneBot v11 协议的 `ocr_image` API
3. **群组配置**：插件会根据内置的群组配置自动识别启动器类型
4. **正则表达式**：关键词回复支持正则表达式，但不区分大小写
5. **防重机制**：延迟发送功能会在3秒后发送消息，如果期间检测到相关群号则取消发送
